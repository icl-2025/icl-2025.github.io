<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="" />
  <title>ICL 2025 - LAB 1 - OCaml Refreshment</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../style.css" />
</head>
<body>
<header id="title-block-header">
<h1 class="title">ICL 2025 - LAB 1 - OCaml Refreshment</h1>
<p class="author"></p>
</header>
<p>The goal of this lab is to serve as a refreshment to the OCaml
language.</p>
<p>Through small programming exercises, you are supposed to get familiar
with the OCaml syntax, compiler, and, most of all, the programming
style. Each exercise is supposed to illustrate/exercise some specific
features of the OCaml language that are of interest for the upcoming
compilers lab sessions and project.</p>
<p>For each exercise, you are supposed to download a tarball file named
<code>XXX.tar.gz</code>. After downloading, you should uncompress it
using <code>tar zxvf XXX.tar.gz</code>, which creates a directory named
<code>XXX</code>. In that directory, you shall find the main file named
<code>XXX.ml</code>, together with a <code>dune</code> file. In order to
compile the exercise, you should run <code>dune build</code> and then
<code>dune exec ./XXX.exe</code> to execute your implementation.</p>
<p>For each exercise, you are asked to complete the definition of some
functions or variables. These are marked in the source code with
<code>assert false (* TODO *)</code>. Of course, you are free (and
encouraged) to write auxiliary functions whenever you find suitable.</p>
<h2 id="exercise-1-copying-a-file">Exercise 1: Copying a file</h2>
<p>This exercise proposes you to write a simple program that reads the
name of two files from the standard input, <code>f1</code> and
<code>f2</code>, and then copies the contents of <code>f1</code> into
<code>f2</code>. The skeleton implementation can be downloaded here: <a
href="copy_file.tar.gz">copy_file.tar.gz</a>.</p>
<p>Your goal is to complete the definition of function
<code>copy</code>, which has the following type:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> copy : <span class="dt">string</span> -&gt; <span class="dt">string</span> -&gt; <span class="dt">unit</span></span></code></pre></div>
<p>The first argument of type <code>string</code> is the name of input
file, let’s call it <code>f1</code>, while the second argument is the
name of the output file, let’s call it <code>f2</code>. The return value
is of type <code>unit</code>, indicating that this function does not
return any value, simply because all it does is to output something into
a file.</p>
<p>Function <code>copy</code> should first open the two files, one for
input the other for output, using the following standard library
functions:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> <span class="dt">open_in</span> : <span class="dt">string</span> -&gt; <span class="dt">in_channel</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> <span class="dt">open_out</span> : <span class="dt">string</span> -&gt; <span class="dt">out_channel</span></span></code></pre></div>
<p>Then, the main job of <code>copy</code> is to implement a loop that
reads the contents of <code>f1</code> and writes it to <code>f2</code>.
For such, you can use either the functions</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> <span class="dt">input_char</span> : <span class="dt">in_channel</span> -&gt; <span class="dt">char</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> <span class="dt">output_char</span> : <span class="dt">out_channel</span> -&gt; <span class="dt">char</span> -&gt; <span class="dt">unit</span></span></code></pre></div>
<p>which, respectively, reads a character from an input channel and
writes a character into an output channel, or you can use</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> <span class="dt">input_line</span> : <span class="dt">in_channel</span> -&gt; <span class="dt">string</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> <span class="dt">output_string</span> : <span class="dt">out_channel</span> -&gt; <span class="dt">string</span> -&gt; <span class="dt">unit</span></span></code></pre></div>
<p>where <code>input_line</code> reads the contents of an input channel
line by line and <code>output_string</code> writes a string into an
output channel.</p>
<p>To write the main <em>fetch-and-write</em> loop, you should write a
recursive function <code>loop ()</code>, whose body is a block of the
form</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">try</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">with</span> <span class="dt">End_of_file</span> -&gt;</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    ...</span></code></pre></div>
<p>where the <code>End_of_file</code> exception, from the standard
library, is raised whenever we reach the end of file <code>f1</code>.
Upon completion, <em>i.e.</em>, after reading the whole contents of
<code>f1</code> into <code>f2</code>, you should close both channels
using the following functions:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> <span class="dt">close_in</span> : <span class="dt">in_channel</span> -&gt; <span class="dt">unit</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> <span class="dt">close_out</span> : <span class="dt">out_channel</span> -&gt; <span class="dt">unit</span></span></code></pre></div>
<p>You should run your solution as follows:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>  <span class="ex">dune</span> exec ./copy_file.exe <span class="op">&lt;</span>XXX<span class="op">&gt;</span> <span class="op">&lt;</span>YYY<span class="op">&gt;</span></span></code></pre></div>
<p>where <code>&lt;XXX&gt;</code> and <code>&lt;YYY&gt;</code> should be
replace with the names of the input and output files, respectively.</p>
<div style="text-align:right">
<p><a href="">solution</a></p>
</div>
<h2 id="exercise-2-reversing-the-order-of-lines-in-a-text">Exercise 2:
Reversing the order of lines in a text</h2>
<p>This exercise proposes you to write a simple program that reads some
lines of text from the standard input and prints them on standard
output, but in reverse order. The skeleton implementation can be
downloaded here: <a
href="reverse_text.tar.gz">reverse_text.tar.gz</a>.</p>
<p>Your goal is to complete the definition of variable
<code>lines</code> and function <code>print</code>, which have the
following types:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> lines : <span class="dt">string</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> print : <span class="dt">string</span> <span class="dt">list</span> -&gt; <span class="dt">unit</span></span></code></pre></div>
<p>In OCaml, one can write arbitrary code, even within the definition of
a global value like <code>lines</code>. In particular, you should
complete the definition of the <code>loop</code> function to read the
contents of standard input until the <code>Ctrl + D</code> combination
is issued to signal the end of input. You should read the text line by
line using the following function:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> <span class="dt">read_line</span> : <span class="dt">unit</span> -&gt; <span class="dt">string</span></span></code></pre></div>
<p>The <code>text</code> local reference serves as accumulator for what
you read from standard input, which you should update using OCaml
references assignment. The following are the most useful functions when
it comes to reference manipulation:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> <span class="dt">ref</span> : &#39;a -&gt; &#39;a <span class="dt">ref</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">(** </span><span class="ot">[</span><span class="dt">ref</span> v<span class="ot">]</span><span class="co"> creates a reference with contents </span><span class="ot">[</span>v<span class="ot">]</span><span class="co"> *)</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> (!) : &#39;a <span class="dt">ref</span> -&gt; &#39;a</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">(** </span><span class="ot">[</span>!r<span class="ot">]</span><span class="co"> returns the contents of reference </span><span class="ot">[</span>r<span class="ot">]</span><span class="co"> *)</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> (:=) : &#39;a <span class="dt">ref</span> -&gt; &#39;a -&gt; <span class="dt">unit</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">(** </span><span class="ot">[</span>r := v<span class="ot">]</span><span class="co"> updates the contents of reference </span><span class="ot">[</span>r<span class="ot">]</span><span class="co"> with value </span><span class="ot">[</span>v<span class="ot">]</span><span class="co"> *)</span></span></code></pre></div>
<p>Finally, <code>print</code> is a recursive function that traverses
its argument <code>l</code>, of type <code>string list</code>, and
prints the string on each list element into the standard output. For
printing, use the following function:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> <span class="dt">print_endline</span> : <span class="dt">string</span> -&gt; <span class="dt">unit</span></span></code></pre></div>
<div style="text-align:right">
<p><a href="">solution</a></p>
</div>
<h2 id="exercise-3-quad-trees">Exercise 3: Quad trees</h2>
<p>In this exercise, you are asked to implement a small library of
<em>Quad</em> trees. The skeleton implementation can be downloaded here:
<a href="quad.tar.gz">quad.tar.gz</a>. We will be using the OCaml
<code>Graphics</code> library to draw images using a simple graphical
interface. In order to install this library on your machine, do</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>  <span class="ex">opam</span> install graphics</span></code></pre></div>
<p>Quad trees are a simple data structure that allows one to encode and
manipulate black-and-white square images of size <span
class="math inline">2<sup><em>n</em></sup> × 2<sup><em>n</em></sup></span>.
If an image is completely black or white, it is represented using a
constant denoting its color. Otherwise, it is decomposed into four
subimages, each of size <span
class="math inline">2<sup><em>n</em> − 1</sup> × 2<sup><em>n</em> − 1</sup></span>,
according to the following order:</p>
<p><img src="quad_order.png" /></p>
<p>An image is, thus, the union of the four sub-images. In our program,
the following type <code>quad</code> corresponds to this
representation:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">type</span> quad = White | Black | Node <span class="kw">of</span> quad * quad * quad * quad</span></code></pre></div>
<p>The constants <code>White</code> and <code>Black</code> respectively
denote an image that is either completely white or completely black. The
constructor <code>Node</code> corresponds to an image decomposed into
four sub-images, which are the four arguments of this constructor.</p>
<p>The following image</p>
<p><img src="quad_example.png" /></p>
<p>is represented by the following value of type <code>quad</code>:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>Node (Node (Black, Black, Black, White),</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>      Black,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>      Node (Black, Black, Black, White),</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>      White)</span></code></pre></div>
<p>The following asks you to implement some functions that manipulate
and/or build quad trees. To help you test your solutions, a
<code>draw</code> function is provided, which has the following
type:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> draw : <span class="dt">int</span> -&gt; <span class="dt">int</span> -&gt; <span class="dt">int</span> -&gt; quad -&gt; <span class="dt">unit</span></span></code></pre></div>
<p>A call <code>draw x y w q</code> draws the quad tree <code>q</code>
in a graphical window with the position <code>(x, y)</code> being the
bottom-left corner of the image, and <code>w</code> the side length of
the square.</p>
<h3 id="question-3.1-build-a-checkerboard">Question 3.1: build a
checkerboard</h3>
<p>Complete the definition of function <code>checker_board</code> with
the following type:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> checker_board : <span class="dt">int</span> -&gt; quad</span></code></pre></div>
<p>Function <code>checker_board</code> takes as input an integer value
<span class="math inline"><em>n</em></span> and builds a quad tree that
represents a <span
class="math inline">2<sup><em>n</em></sup> × 2<sup><em>n</em></sup></span>
checkerboard. As an example, the return value of
<code>checker_board 3</code> corresponds to the following image:</p>
<p><img src="quad_checker_board.png" /></p>
<p>To implement <code>checker_board</code>, we proceed by recursion on
the value of <span class="math inline"><em>n</em></span>, as
follows:</p>
<ol type="1">
<li>If <span class="math inline"><em>n</em> = 0</span>, we make an
arbitrary choice and return a black square.</li>
<li>If <span class="math inline"><em>n</em> = 1</span>, we return a
checkerboard of size <span class="math inline">2 × 2</span>.</li>
<li>Finally, if <span class="math inline"><em>n</em> &gt; 1</span>, we
construct a <span
class="math inline">2<sup><em>n</em> − 1</sup> × 2<sup><em>n</em> − 1</sup></span>
checkerboard that we use four times over to construct a checkerboard of
size <span
class="math inline">2<sup><em>n</em></sup> × 2<sup><em>n</em></sup></span>.</li>
</ol>
<h3 id="question-3.2-rotate-an-image">Question 3.2: rotate an image</h3>
<p>Complete the definition of function <code>rotate</code> with the
following type:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> rotate : quad -&gt; quad</span></code></pre></div>
<p>This function turns an image anticlockwise by 90 degrees.</p>
<h3 id="question-3.3-mirror-of-an-image">Question 3.3: mirror of an
image</h3>
<p>Complete the definition of function <code>mirror</code> with the
following type:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> mirror : quad -&gt; quad</span></code></pre></div>
<p>This function constructs the mirror symmetry along the vertical axis
of an image represented by a quad tree. Thus, the function mirror allows
switching between the following two images:</p>
<p><img src="quad_mirror.png" /></p>
<h3 id="question-3.4-from-a-quad-tree-to-a-string">[**] Question 3.4:
from a quad tree to a string</h3>
<p>Complete the definition of function <code>parse</code> with the
following type:</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> unparse : quad -&gt; <span class="dt">string</span></span></code></pre></div>
<p>This function builds a binary representation of a quad tree, encoded
as a string. For instance, the following image</p>
<p><img src="quad_simple.png" /></p>
<p>should be converted into the string <code>0101</code>.</p>
<h3 id="question-3.5-from-string-to-a-quad-tree">[***] Question 3.5:
from string to a quad tree</h3>
<p>Complete the definition of function <code>parse</code> with the
following type:</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> parse : <span class="dt">string</span> -&gt; quad</span></code></pre></div>
<p>This function constructs a quad tree from a binary representation of
an image, encoded as a string. It is the dual of the above
<code>unparse</code> function.</p>
<p><strong>[Hint]:</strong> assume that a binary representation of a
quad tree is always a string of size <span
class="math inline">2<sup><em>n</em></sup></span>, for some <span
class="math inline"><em>n</em></span>. In order to recursively build the
four sub-images, you can start by spliting the initial string into two
sub-strings of length <span
class="math inline">2<sup><em>n</em> − 1</sup></span>, and then each
such sub-string into sub-strings of length <span
class="math inline">2<sup><em>n</em> − 2</sup></span>, and so on. To do
so, you can use the following function</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> sub : <span class="dt">string</span> -&gt; <span class="dt">int</span> -&gt; <span class="dt">int</span> -&gt; <span class="dt">string</span></span></code></pre></div>
<p>from the <code>String</code> module. A call
<code>sub s pos len</code> returns a string of length <code>len</code>,
containing the substring of <code>s</code> that starts at position
<code>pos</code> and has length <code>len</code>. The length of a string
<code>s</code> is given by <code>String.length s</code>.</p>
<h3 id="bonus-question-invariants">Bonus Question: invariants</h3>
<p>One may wish to guarantee the property that a quad tree is never made
up of four leaves of the same color, since that would be an
unnecessarily complicated representation. To enforce this invariant, as
an alternative to the constructor <code>Node</code>, we must then
provide a function <code>node</code>, defined so as to guarantee the
invariant. This function as the following type:</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> node : (quad, quad, quad, quad) -&gt; quad</span></code></pre></div>
<p>If all elements in the tuple are of the same color <code>c</code>, it
should just return <code>c</code>. Otherwise, return a value using the
constructor <code>Node</code> and the four sub-quad trees given as
arguments.</p>
<p>You can now use the <code>node</code> function within the definition
of some of the previous quad tree manipulation functions.</p>
<div style="text-align:right">
<p><a href="">solution</a></p>
</div>
<h2 id="exercise-4-reading-a-musical-score-from-a-file">Exercise 4:
reading a musical score from a file</h2>
<p>In this exercise, your goal is to extend the lecture demo program to
play a musical score read from a file. The skeleton implementation can
be downloaded here: <a href="music.tar.gz">music.tar.gz</a>. To use the
<code>play</code> command, you must first install the SoX package. You
can follow the installation procedures described <a
href="https://arielvb.readthedocs.io/en/latest/docs/commandline/sox.html">here</a>.</p>
<p>Your goal for this exercise is to complete the definition of function
<code>file</code>, with the following type:</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> file : <span class="dt">string</span> -&gt; score</span></code></pre></div>
<p>The argument of type <code>string</code> stands for the file name
from which you should read the musical score.</p>
<p>A file description of a musical score shall specify the tempo of play
and a list of symbols. For simplicity, let us consider that symbols can
only be musical notes and not silences. Hence, we propose the following
grammar for a musical score file:</p>
<pre><code> f ::= &quot;TEMPO&quot; : N&#39;\n&#39;
       (s : O d)+

 s ::= &quot;Do&quot;  | &quot;Re&quot; | &quot;Mi&quot; | &quot;Fa&quot;
     | &quot;Sol&quot; | &quot;La&quot; | &quot;Si&quot;

 d ::= &quot;Six&quot; | &quot;Eighth&quot; | &quot;Quarter&quot; | &quot;Half&quot; | &quot;Full&quot;</code></pre>
<p>The first line of the file contains the string <strong>TEMPO</strong>
followed by character ‘:’ and then and integer value, which represents
the tempo of the score. Then, the remaining of the file is a list of
notes. Each line begins by the name of the note (rule <code>s</code> in
the grammar above), followed by ‘:’, the value of the octave
(<code>O</code>, an integer value), and finally the duration (rule
<code>d</code> above).</p>
<p>In your implementation, you are expected to read the contents of a
file following the above grammar, until the <code>End_of_file</code>
exception is raised. After this first step, you need to parse the
textual contents you just read. You are, thus, supposed to separate the
different components of each line according to its semantics. To split a
line based on some character, use the following function:</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> split_on_char : <span class="dt">char</span> -&gt; <span class="dt">string</span> -&gt; <span class="dt">string</span> <span class="dt">list</span></span></code></pre></div>
<p>This function is defined in the <code>String</code> module from the
OCaml standard library. You can use by doing
<code>String.split_on_char</code>.</p>
<p>To avoid trailing white spaces, use the function</p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> trim : <span class="dt">string</span> -&gt; <span class="dt">string</span></span></code></pre></div>
<p>also from the <code>String</code> module.</p>
<p>We recommend you to first implement a fully-working solution that
assumes the file to be syntactically well-formed, <em>i.e.</em>, it
obeys the given grammar. Afterwards, try to refine your implementation
to include some error signaling. For instance, to signal that the first
line of the file is not of the form <code>"TEMPO" : N</code>, or that a
name of a note is not in the list <code>Do ... Si</code>. For each kind
of error, exit your program with a different error code. To do so, use
the following function:</p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> <span class="dt">exit</span> : <span class="dt">int</span> -&gt; &#39;a</span></code></pre></div>
<p>where the argument of type <code>int</code> is the exit error
code.</p>
<p>Before exiting, it might be interesting to produce an error message.
You can proceed in two ways: either print a message on the standard
error before exiting, or raise an exception to be caught in the main
function that executes your program.</p>
<p>A new exception in OCaml is easily defined in OCaml, as a global
name, as follows:</p>
<div class="sourceCode" id="cb28"><pre
class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">exception</span> Syntax_error</span></code></pre></div>
<p>You can raise as follows:</p>
<div class="sourceCode" id="cb29"><pre
class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>  <span class="dt">raise</span> Syntax_error</span></code></pre></div>
<p>For each kind of exceptions, an error message is expected to be
produced on the standard error file. To do so, use the following
function:</p>
<div class="sourceCode" id="cb30"><pre
class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> eprintf : (&#39;a, <span class="dt">Format</span>.formatter, <span class="dt">unit</span>) <span class="dt">format</span> -&gt; &#39;a</span></code></pre></div>
<p>The type of this function is certainly not very nice. But worry not,
its usage is quite easy in fact. This is as simple as follows:</p>
<div class="sourceCode" id="cb31"><pre
class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Format</span>.eprintf <span class="st">&quot;Syntax error@.&quot;</span></span></code></pre></div>
<p>where the <code>@.</code> sign is used to flush the standard error
and print the newline character.</p>
<p>You should run your solution as follows:</p>
<div class="sourceCode" id="cb32"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>  <span class="ex">dune</span> exec ./music.exe <span class="op">&lt;</span>XXX<span class="op">&gt;</span></span></code></pre></div>
<p>where <code>&lt;XXX&gt;</code> should be replace with the name of the
file containing the score description. As an example, we provide the
file <code>frere_jacques</code> in the tarball, which describes the
Frère Jacques song, as shown during lecture. You can run your solution
to read this file as follows:</p>
<div class="sourceCode" id="cb33"><pre
class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>  dune exec ./music.exe frere_jacques</span></code></pre></div>
<div style="text-align:right">
<p><a href="">solution</a></p>
</div>
<hr />
<!--
Local Variables:
compile-command: "pandoc -s -c ../style.css index.md -o index.html -A footer.html"
End:
-->
<div id="footer">
  <font size="-1"><a href="../index.html">back to the main page</a></font>
</div>
</body>
</html>
